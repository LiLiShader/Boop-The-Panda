# 修复商品信息显示问题

这个指南将帮助您修复运维系统中商品信息不显示的问题。

## 问题分析

从数据库表结构可以看到，`payment_records` 表已经成功添加了商品信息相关字段：
- `product_id`
- `product_info`
- `product_details`

但是，现有的订单记录中这些字段可能是空的，所以运维系统无法显示商品详情。

## 解决步骤

### 1. 更新现有订单记录

我们需要根据订单金额来推断商品类型，并更新现有订单记录的商品信息。

在服务器上执行以下命令：

```bash
# 登录到MySQL/MariaDB
mysql -u root -p game_db

# 在MySQL提示符下执行以下命令
source update-existing-orders.sql
```

或者直接执行：

```bash
mysql -u root -p game_db < update-existing-orders.sql
```

### 2. 验证API返回数据

运行测试脚本，验证API返回的数据是否包含商品信息：

```bash
node test-api.js
```

### 3. 重启后端服务

更新完数据库后，重启后端服务以确保所有更改生效：

```bash
pm2 restart game-acc
```

### 4. 测试前端显示

1. 打开运维系统前端页面
2. 查询一个用户的支付记录或所有支付记录
3. 验证商品信息是否正确显示

## 常见问题

### 商品信息仍然不显示

如果更新数据库后，商品信息仍然不显示，可能有以下原因：

1. **API返回数据不包含商品信息字段**
   - 检查后端API代码是否正确返回商品信息字段
   - 执行 `test-api.js` 脚本，查看API返回的数据

2. **前端解析商品信息有误**
   - 检查前端代码中的 `getOrderItemName` 函数是否正确解析商品信息
   - 特别是对JSON格式的 `product_details` 字段的解析

3. **数据库字段类型不匹配**
   - 确保 `product_details` 字段是 JSON 或 TEXT 类型
   - 确保存储的JSON数据格式正确

### 新订单的商品信息不显示

如果只有新订单的商品信息不显示，可能是客户端上传支付记录时没有包含商品信息字段。检查 `payManager.ts` 中的支付记录上传代码。

## 后续建议

1. **监控新订单**：定期检查新订单是否包含商品信息
2. **完善错误处理**：在前端代码中添加更多的错误处理和日志记录
3. **数据备份**：在大规模更新数据库前，先备份数据 