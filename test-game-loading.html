<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏加载测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .console {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎮 游戏加载测试</h1>
        
        <div class="status info">
            <strong>测试说明：</strong> 此页面用于测试游戏是否能正常加载，检查各种依赖和配置是否正确。
        </div>
        
        <div class="status warning">
            <strong>注意：</strong> 已移除测试脚本，避免影响游戏正常加载。
        </div>
        
        <div>
            <button onclick="testEnvironment()">测试环境配置</button>
            <button onclick="testNetworkConnection()">测试网络连接</button>
            <button onclick="testPaymentModeAPI()">测试支付模式API</button>
            <button onclick="clearConsole()">清空控制台</button>
        </div>
        
        <div class="status info">
            <strong>控制台输出：</strong>
        </div>
        
        <div id="console-output" class="console">
            等待测试...
        </div>
        
        <div class="status info">
            <strong>测试结果：</strong>
        </div>
        
        <div id="test-results">
            <div class="status warning">尚未开始测试</div>
        </div>
    </div>

    <script>
        // 控制台输出管理
        const consoleOutput = document.getElementById('console-output');
        const testResults = document.getElementById('test-results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            consoleOutput.textContent += logMessage;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // 同时在浏览器控制台输出
            console.log(`[${timestamp}] ${message}`);
        }
        
        function addResult(message, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.innerHTML = message;
            testResults.appendChild(resultDiv);
        }
        
        function clearConsole() {
            consoleOutput.textContent = '';
            testResults.innerHTML = '<div class="status warning">控制台已清空</div>';
        }
        
        // 测试环境配置
        async function testEnvironment() {
            log('开始测试环境配置...');
            
            try {
                // 检查基本环境
                log('检查浏览器环境...');
                log(`User Agent: ${navigator.userAgent}`);
                log(`Platform: ${navigator.platform}`);
                log(`Language: ${navigator.language}`);
                
                // 检查Cocos Creator环境
                log('检查Cocos Creator环境...');
                if (typeof cc !== 'undefined') {
                    log('✅ Cocos Creator 已加载');
                    log(`Cocos Creator 版本: ${cc.version || '未知'}`);
                } else {
                    log('❌ Cocos Creator 未加载');
                }
                
                // 检查全局对象
                log('检查全局对象...');
                if (typeof window !== 'undefined') {
                    log('✅ window 对象可用');
                }
                if (typeof document !== 'undefined') {
                    log('✅ document 对象可用');
                }
                
                addResult('✅ 环境配置测试完成', 'success');
                
            } catch (error) {
                log(`❌ 环境配置测试失败: ${error.message}`, 'error');
                addResult(`❌ 环境配置测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试网络连接
        async function testNetworkConnection() {
            log('开始测试网络连接...');
            
            try {
                // 测试基本网络连接
                log('测试基本网络连接...');
                const response = await fetch('https://httpbin.org/get');
                if (response.ok) {
                    log('✅ 基本网络连接正常');
                } else {
                    log('❌ 基本网络连接异常');
                }
                
                // 测试后端API连接
                log('测试后端API连接...');
                try {
                    const apiResponse = await fetch('http://119.91.142.92:3000/health');
                    if (apiResponse.ok) {
                        log('✅ 后端API连接正常');
                    } else {
                        log('❌ 后端API连接异常');
                    }
                } catch (apiError) {
                    log(`❌ 后端API连接失败: ${apiError.message}`);
                }
                
                addResult('✅ 网络连接测试完成', 'success');
                
            } catch (error) {
                log(`❌ 网络连接测试失败: ${error.message}`, 'error');
                addResult(`❌ 网络连接测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试支付模式API
        async function testPaymentModeAPI() {
            log('开始测试支付模式API...');
            
            try {
                // 测试获取支付模式
                log('测试获取支付模式...');
                const response = await fetch('http://119.91.142.92:3000/api/config/payment/mode');
                
                if (response.ok) {
                    const result = await response.json();
                    log(`✅ 获取支付模式成功: ${JSON.stringify(result)}`);
                    
                    if (result.success) {
                        log(`当前支付模式: ${result.data.mode}`);
                    } else {
                        log(`❌ API返回错误: ${result.message}`);
                    }
                } else {
                    log(`❌ API请求失败: ${response.status} ${response.statusText}`);
                }
                
                addResult('✅ 支付模式API测试完成', 'success');
                
            } catch (error) {
                log(`❌ 支付模式API测试失败: ${error.message}`, 'error');
                addResult(`❌ 支付模式API测试失败: ${error.message}`, 'error');
            }
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', () => {
            log('页面加载完成，开始初始化测试...');
            log('已移除测试脚本，避免影响游戏加载');
            addResult('✅ 页面初始化完成', 'success');
        });
    </script>
</body>
</html> 